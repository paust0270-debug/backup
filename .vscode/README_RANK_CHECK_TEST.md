# 🎯 쿠팡 순위체크 테스트 (Playwright MCP)

쿠팡에서 실제 상품 순위를 체크하는 자동화 테스트입니다.

## 🚀 빠른 시작

### 1. 의존성 설치

```bash
npm install
npx playwright install
```

### 2. 테스트 실행

```bash
# 기본 실행 (백그라운드)
npm run test:rank

# 브라우저 창 보면서 실행
npm run test:headed

# 디버그 모드 (단계별 실행)
npm run test:debug

# 직접 실행
node rank_check_test_with_playwright.js
```

## 📋 테스트 조건

### 🔍 검색 설정
- **키워드**: "장난감"
- **대상 상품번호**: `8617045901`
- **최대 검색 범위**: 상위 100개 상품

### ⏱️ 사람다운 동작 시뮬레이션
- **키 입력 딜레이**: 100~200ms (랜덤)
- **스크롤 지연**: 500~1500ms (랜덤)
- **스크롤 횟수**: 2~3번에 나누어 실행

### 🎛️ 브라우저 설정
- **화면 크기**: 1920x1080
- **User-Agent**: 실제 브라우저로 위장
- **이미지/폰트 차단**: 로딩 속도 최적화

## 📊 테스트 실행 결과

### ✅ 성공 예시
```
✅ 상품번호 1234567890은 장난감 검색 결과에서 15위입니다.
```

### ❌ 실패 예시
```
❌ 상품번호 1234567890은 장난감 검색 결과에서 상위 100위 안에 없습니다.
```

### 📈 상세 로그 예시
```
🚀 쿠팡 순위체크 테스트 시작
🎯 검색 키워드: "장난감"
🎯 대상 상품번호: "8617045901"
🎯 최대 검색 상품 수: 100개
============================================================

🌐 쿠팡 검색 페이지로 이동 중...
📝 검색창에 키워드 입력 시작...
⌨️  "장" 입력 시작...
⌨️  "나" 입력 시작...
⌨️  "감" 입력 시작...
✅ 입력 완료: "장난감"
🔍 검색 실행
⏳ 검색 결과 페이지 로딩 대기 중...
📜 상품 목록 스크롤 시작...
📜 스크롤 단계 1/3
⏳ 1283ms 대기 중...
📦 현재까지 로딩된 상품 수: 24개
📜 스크롤 단계 2/3
⏳ 943ms 대기 중...
📦 현재까지 로딩된 상품 수: 58개
📜 스크롤 단계 3/3
⏳ 1127ms 대기 중...
📦 현재까지 로딩된 상품 수: 89개
✅ 스크롤 완료
🔍 상품 카드 분석 시작...
📦 선택자 "[data-product-id]"로 89개 상품 발견
📊 총 89개 상품 분석 시작
🔍 순위 1: 상품번호 7822451347
🔍 순위 2: 상품번호 190153543
...
🔍 순위 15: 상품번호 8617045901
🎯 목표 상품 발견! 순위: 15
============================================================
✅ 상품번호 8617045901은 장난감 검색 결과에서 15위입니다.
============================================================
```

## 🛠️ 커스터마이징

### 테스트 설정 변경

`rank_check_test_with_playwright.js` 파일의 `TEST_CONFIG` 객체를 수정하세요:

```javascript
const TEST_CONFIG = {
  keyword: '무선이어폰',           // 검색 키워드 변경
  targetProductId: '1234567890',   // 대상 상품번호 변경
  searchUrl: 'https://www.coupang.com/np/search?q=',
  maxProducts: 50,                 // 최대 검색 상품 수 변경
  scrollDelay: {                   // 스크롤 지연 시간 변경
    min: 300,
    max: 800
  },
  typeDelay: {                     // 키 입력 딜레이 변경
    min: 80,
    max: 150
  }
};
```

### 브라우저 설정 변경

`playwright.config.js`에서 브라우저 옵션을 수정할 수 있습니다:

```javascript
launchOptions: {
  args: [
    '--disable-web-security',
    '--disable-features=VizDisplayCompositor',
    // 추가 옵션들...
  ]
}
```

## 🐛 문제 해결

### 자주 발생하는 문제

1. **브라우저 설치 실패**
   ```bash
   npx playwright install --force
   ```

2. **네트워크 타임아웃**
   - `playwright.config.js`에서 타임아웃 값 증가
   - 인터넷 연결 상태 확인

3. **요청 차단됨**
   - User-Agent 변경
   - 프록시 사용 고려
   - 실행 간격 조절

4. **상품을 찾을 수 없음**
   - 키워드 변경
   - 상품번호 확인
   - 검색 범위 증대

### 디버깅 팁

- `--headed` 옵션으로 브라우저 창 보면서 실행
- `--debug` 옵션으로 단계별 실행
- 개발자 도구 콘솔 로그 확인

## 📁 파일 구조

```
├── rank_check_test_with_playwright.js  # 메인 테스트 파일
├── playwright.config.js                 # Playwright 설정
├── package.json                         # 프로젝트 설정
├── README_RANK_CHECK_TEST.md            # 이 파일
└── test-results/                        # 테스트 결과 (자동 생성)
    ├── html/
    ├── test-results.json
    └── test-results.xml
```

## 🚨 주의사항

1. **쿠팡 정책 준수**: 과도한 요청으로 차단될 수 있습니다.
2. **실행 간격**: 연속 실행 시 충분한 간격을 두세요.
3. **데이터 정확성**: 실제 검색 결과와 차이가 있을 수 있습니다.
4. **네트워크 상태**: 안정적인 네트워크에서 실행하세요.

## 🤝 기여하기

테스트 개선사항이나 버그 리포트는 언제든 환영합니다!

---

**Happy Testing! 🎉**
