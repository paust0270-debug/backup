# 쿠팡 상품 순위 확인 도구

자연스러운 타이핑과 스크롤링을 통해서 쿠팡에서 특정 상품의 검색 순위를 확인하는 Playwright 기반 자동화 도구입니다.

## 🎯 주요 기능

- **자연스러운 타이핑**: 100~200ms 랜덤 딜레이로 사람처럼 한 글자씩 입력
- **스마트 스크롤링**: 3단계로 나누어 스크롤, 각 구간마다 500~1500ms 대기
- **상품 ID 추출**: data-product-id 속성 및 URL에서 product ID 자동 추출
- **순위 확인**: 상위 100개 상품 중에서 타겟 상품의 정확한 순위 확인
- **성능 최적화**: 불필요한 리소스 차단으로 빠른 로딩

## 📦 설치 및 설정

### 1. 의존성 설치

```bash
npm install
npm run install:browsers
```

또는 한 번에 설정:

```bash
npm run setup
```

### 2. 브라우저 드라이버 설치 확인

```bash
npx playwright install chromium
```

## 🚀 사용법

### 기본 사용 (특정 상품 검색)

```bash
# 기본 상품번호(8617045901)로 검색
npm run check-coupean

# 특정 상품번호로 검색
npm run check-coupean -p 8617045901
```

### 상세 옵션

```bash
# 헤드리스 모드로 실행 (브라우저 창 숨김)
npm run check-coupean --headless

# 디버그 모드로 실행
npm run check-coupean --debug
```

### Playwright 테스트 명령어

```bash
# 기본 테스트 실행 (헤드리스)
npm run test:coupang-rank

# 브라우저 창을 보면서 테스트 실행
npm run test:coupang-ranked
```

## 🔍 검색 프로세스

1. **쿠팡 메인 페이지 접속**
   - 네트워크 최적화 설정 적용
   - 검색창 자동 감지

2. **자연스러운 타이핑**
   - '자전거 자물쇠' 키워드를 100~200ms 랜덤 딜레이로 한 글자씩 입력
   - 사람의 타이핑 패턴 시뮬레이션

3. **검색 실행 및 결과 확인**
   - Enter키로 검색 실행
   - 검색 결과 페이지 로딩 대기

4. **스마트 스크롤링**
   - 페이지를 3단계(30%, 60%, 100%)로 나누어 스크롤
   - 각 구간마다 500~1500ms 랜덤 대기
   - 최대 100개 상품까지 순차적으로 수집

5. **상품 ID 추출 및 순위 확인**
   - 각 상품에서 data-product-id 속성 또는 URL 내 productId 추출
   - 타겟 상품과 비교하여 순위 계산

## 📋 출력 예시

```
🎯 상품번호 8617045901의 순위를 확인하기 시작합니다...
🔍 검색 키워드: 자전거 자물쇠
📱 쿠팡 메인 페이지로 이동 중...
🔍 검색창 발견: input[name="q"]
⌨️ 자연스러운 타이핑으로 검색어 입력 중...
🔍 검색 실행...
✅ 검색 결과 페이지 로딩 완료
📜 상품 리스트를 스크롤하며 수집 중...
📜 1단계 스크롤: 30% 위치로 이동...
⏱️ 847ms 대기 중...
📦 이번 단계에서 25개 새 상품 발견. 총 25개 수집됨
📜 2단계 스크롤: 60% 위치로 이동...
⏱️ 1203ms 대기 중...
📦 이번 단계에서 35개 새 상품 발견. 총 60개 수집됨
📜 3단계 스크롤: 100% 위치로 이동...
⏱️ 956ms 대기 중...
📦 이번 단계에서 40개 새 상품 발견. 총 100개 수집됨
🎯 목표 상품 수(100개) 달성!
📊 총 100개 상품 수집 완료
🎉 찾았습니다! 상품번호 8617045901은 자전거 자물쇠 검색 결과에서 15위입니다.

📋 수집된 상품 목록 (처음 10개):
  📦 1위: 12345678901
  📦 2위: 12345678912
  📦 3위: 12345678923
  ...
  🎯 15위: 8617045901
```

## ⚙️ 설정 파일

### `playwright.config.js`
- 브라우저 설정 및 타임아웃 구성
- 성능 최적화 옵션
- 리포터 설정

### `test_coupang_rank_checker.spec.js`
- 메인 테스트 로직
- 자연스러운 타이핑 함수
- 스크롤링 및 상품 수집 로직

## 🔧 커스터마이징

### 다른 키워드로 검색
`test_coupang_rank_checker.spec.js` 파일에서 검색어를 변경:

```javascript
await naturalType(page, searchInput, '원하는 검색어');
```

### 다른 상품 번호 확인
명령어 옵션 사용:

```bash
npm run check-coupean -p 1234567890
```

### 스크롤 범위 조정
테스트 파일에서 `scrollStages` 배열 수정:

```javascript
const scrollStages = [25, 50, 75, 100]; // 4단계로 변경
```

## 🐛 문제 해결

### 브라우저 드라이버 오류
```bash
npm run install:browsers
```

### 네트워크 타임아웃
- 인터넷 연결 확인
- 쿠팡 사이트 접근 가능 여부 확인
- 방화벽 설정 확인

### 검색창을 찾을 수 없는 경우
- 쿠팡 사이트 구조 변경 시 선택자 업데이트 필요
- `searchSelectors` 배열에 새로운 선택자 추가

## 📄 라이선스

MIT License

## ⚠️ 주의사항

- 이 도구는 교육 및 연구 목적으로만 사용하세요
- 과도한 요청은 사이트 성능에 영향을 줄 수 있습니다
- 정기적인 간격을 두고 사용하세요
- 웹사이트 이용약관을 준수하세요
